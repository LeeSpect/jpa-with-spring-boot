- <a href="https://github.com/kkyu8925/jpa-with-spring-boot">홈</a>

### 쿼리 메서드 기능 3가지

- 메서드 이름으로 쿼리 생성
- 메서드 이름으로 JPA NamedQuery 호츌 -> 잘 사용안함
- '@Query' 사용해서 레파지토리 인터페이스에 쿼리 직접 정의
  <br/>
  <a href="https://github.com/kkyu8925/jpa-with-spring-boot/blob/main/data-jpa/src/main/java/study/datajpa/repository/MemberRepository.java">
  @Query 소스코드</a>
  <br/>
  <a href="https://github.com/kkyu8925/jpa-with-spring-boot/blob/main/data-jpa/src/test/java/study/datajpa/repository/MemberRepositoryTest.java">
  @Query test 소스코드</a>

### 스프링 데이터 JPA 페이징과 정렬

- Page<Member> findByUsername(String name, Pageable pageable); // count 쿼리 사용
- Slice<Member> findByUsername(String name, Pageable pageable); // count 쿼리 사용 안함
- List<Member> findByUsername(String name, Pageable pageable); // count 쿼리 사용 안함
- List<Member> findByUsername(String name, Sort sort);

### 스프링 데이터 JPa 페이징과 정렬 - web 확장

<a href="https://github.com/kkyu8925/jpa-with-spring-boot/blob/main/data-jpa/src/main/java/study/datajpa/controller/MemberController.java">
web 확장 소스코드</a>

```java
@GetMapping("/members")
public Page<MemberDto> list(Pageable pageable){
        return memberRepository.findAll(pageable).map(MemberDto::new);
        }
```

- 피라미터로 Pageable 을 받을 수 있다.
- org.spirngframework.data.domain.PageRequest 객체 생성

```text
* 요청 피라미터
- ex) '/members?page=0&size=3&sort=id,desc&username,desc'
- page : 현재 페이지, 0부터 시작
- size : 한페이지에 노출할 데이터 건수
- sort : 정렬 (asc 생략 가능)
```

```text
* 글로벌 설정: 스프링 부트
- spring.data.web.pageable.default-page-size = 20 # default
- spring.data.web.pageable.max-page-size=2000 # 최대 페이지 사이즈

* 개별 설정
- @PagealbeDefault 사용

@GetMapping("/members")
public Page<MemberDto> list(@PageableDefault(size = 12, sort = "username")Pageable pageable){
        return memberRepository.findAll(pageable).map(MemberDto::new);
        }

```

### 스프링 데이터 JPA fetch join

```java
@Override
@EntityGraph(attributePaths = {"team"})
List<Member> findAll();
```

### JPA hint

- JPA 쿼리 힌트 : JPA 구현체(하이버네이트)에게 제공하는 힌트

```java
@QueryHints(value = @QueryHint(name = "org.hibernate.readOnly", value = "true"))
Member findReadOnlyByUsername(String username);
```

### 스프링 데이터 JPA auditing

- @EnableJpaAuditing -> 스프링 부트 설정 클래스에 적용
- @EntityListeners(AuditingEntityListener.class) -> 엔티티에 적용

```text
* 사용 어노테이션
- @CreatedDate
- @LastModifiedDate
- @CreateBy
- @lastModifiedBy
```